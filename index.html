<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Cony Terminal: Absolute Final Script (V5 - Final Functionality)</title>
    <style>
        /* === CSS: ê¸°ë³¸ ìŠ¤íƒ€ì¼ === */
        body {
            background-color: #0000AA; 
            color: #FFFFFF;
            font-family: 'Courier New', Courier, monospace; 
            font-size: 18px; 
            margin: 0;
            padding: 20px;
            height: 100vh;
            overflow: hidden;
            position: relative; 
        }

        #message-container {
            width: 100%;
            height: 90vh; 
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        .line {
            line-height: 1.5;
            white-space: pre; 
            opacity: 0; 
            margin: 0;
        }

        /* === í† ë¼ ì´ë¯¸ì§€ (y/n ì „ ë“±ì¥) === */
        #rabbit-img {
            content: url('rabbit.png'); 
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); 
            width: 100px; 
            height: auto;
            opacity: 0; 
            z-index: 20; 
            transition: opacity 0.5s ease-in-out; 
            display: none; 
        }
        
        /* === ë³¼ë“œì²´ ìŠ¤íƒ€ì¼ === */
        .bold {
            font-weight: bold;
        }
        
        /* === Oh dear! ìŠ¤íƒ€ì¼: ê¸€ì”¨í¬ê¸° ë™ì¼, ë³¼ë“œ, ê¸°ìš¸ì„ ì œê±°, ë¹› íš¨ê³¼ ì œê±° === */
        .rabbit-dialog {
            font-size: 18px; 
            font-weight: bold; 
            font-style: normal; 
            color: #FFFFFF;
            text-shadow: none; 
        }

        /* === ì»¤ì„œ ë° ê¸€ë¦¬ì¹˜ ìŠ¤íƒ€ì¼ === */
        .blinking-cursor {
            animation: blink 0.7s infinite;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
        .glitch-cursor {
            animation: glitch-blink 0.1s infinite step-end; 
        }
        @keyframes glitch-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body id="terminal">
    <div id="rabbit-img"></div> 
    <div id="message-container"></div>
    
    <script>
        const messageContainer = document.getElementById('message-container');
        const rabbitImg = document.getElementById('rabbit-img');
        
        const YOUTUBE_URL = "https://youtube.com/@conyca?si=t19YccJ7cFmYJE9X";

        // ìŠ¤í¬ë¦½íŠ¸ ë°°ì—´: ëª¨ë“  í…ìŠ¤íŠ¸ë¥¼ ìˆœì„œëŒ€ë¡œ ë‚˜ì—´
        const script = [
            { text: "Hello. I am ", type: 'normal', pause: 0, line: 'new' }, 
            { text: "Dolores", type: 'bold', pause: 0, line: 'continue' },
            { text: ". I am the administrator of this page.", type: 'normal', pause: 1500, line: 'continue' },
            { text: "This place will soon heal and renew your body and mind.", type: 'normal', pause: 1500, line: 'new' }, 
            
            // Glitch Script (2ë‹¨ê³„ ì‹¬í™” í˜¼ë€)
            { text: "For a moment, escape all anxiety, pain, and emptiness, ", type: 'normal', pause: 2500, line: 'new' }, 
            { text: "free your soul, and discover your true self...f981gh", type: 'glitch', pause: 0, line: 'continue', interrupt: true }, 
            
            // Oh dear! (ë³¼ë“œì²´)
            { text: "Oh dear! Oh dear! I shall be too late!", type: 'rabbit', pause: 1500, line: 'new' }, 
            
            // ìµœì¢… ëŒ€ì‚¬ 
            { text: "Follow the white rabbit.", type: 'normal', pause: 0, line: 'new', final: true } 
        ];
        
        let scriptIndex = 0;
        let typingTimeout; 
        const defaultSpeed = 50; 
        const glitchSpeed = 20; 

        // ë©”ì‹œì§€ë¥¼ íƒ€ì´í•‘í•˜ëŠ” í•µì‹¬ í•¨ìˆ˜
        function typeLine(item, callback) {
            let line;
            
            if (item.line === 'new') {
                line = document.createElement('p');
                line.classList.add('line');
                if (item.type === 'rabbit') {
                    line.classList.add('rabbit-dialog');
                }
                messageContainer.appendChild(line);
                line.style.opacity = 1; 
                messageContainer.scrollTop = messageContainer.scrollHeight;
            } else {
                line = messageContainer.lastElementChild;
                if (!line) return callback();
                const prevCursor = line.querySelector('.blinking-cursor') || line.querySelector('.glitch-cursor');
                if (prevCursor) line.removeChild(prevCursor);
            }
            
            let textToType = item.text;
            let charIndex = 0;
            let currentSpeed = item.type === 'glitch' ? glitchSpeed : defaultSpeed;
            let glitch_triggered_1 = false; 
            let glitch_triggered_2 = false; 
            
            const cursorSpan = document.createElement('span');
            cursorSpan.classList.add('blinking-cursor');
            cursorSpan.textContent = '_';
            line.appendChild(cursorSpan);

            function typeChar() {
                // === 2ë‹¨ê³„ Glitch íŠ¸ë¦¬ê±° ì²´í¬ ===
                if (item.type === 'glitch' && charIndex < textToType.length) {
                    const currentString = textToType.substring(0, charIndex + 1);
                    
                    if (currentString.includes("free") && !glitch_triggered_1) {
                        glitch_triggered_1 = true;
                        cursorSpan.classList.add('glitch-cursor');
                        cursorSpan.classList.remove('blinking-cursor');
                        simulateTypingGlitch(line, cursorSpan, 6, () => {
                            typeChar(); 
                        });
                        return;
                    } 
                    
                    if (currentString.includes("your") && !glitch_triggered_2) {
                        glitch_triggered_2 = true;
                        cursorSpan.classList.add('glitch-cursor');
                        cursorSpan.classList.remove('blinking-cursor');
                        simulateTypingGlitch(line, cursorSpan, 8, () => { 
                            typeChar(); 
                        });
                        return;
                    }
                }
                
                // === íƒ€ì´í•‘ ë¡œì§ ===
                if (charIndex < textToType.length) {
                    const char = textToType.charAt(charIndex);
                    
                    if (item.type === 'bold') {
                        let boldSpan = line.querySelector('.bold');
                        if (!boldSpan) {
                            boldSpan = document.createElement('span');
                            boldSpan.classList.add('bold');
                            line.insertBefore(boldSpan, cursorSpan);
                        }
                        boldSpan.appendChild(document.createTextNode(char));
                    } else {
                        line.insertBefore(document.createTextNode(char), cursorSpan);
                    }
                    
                    charIndex++;
                    typingTimeout = setTimeout(typeChar, currentSpeed);

                } else {
                    // === íƒ€ì´í•‘ ì™„ë£Œ í›„ ì²˜ë¦¬ ===
                    clearTimeout(typingTimeout); 

                    if (item.final) {
                        handleFinalSequence(line, cursorSpan);
                    } else {
                        setTimeout(() => {
                            line.removeChild(cursorSpan);
                            callback(); 
                        }, item.pause);
                    }
                }
            }
            typeChar();
        }

        // === â—ï¸ ì˜¤íƒ€/ì§€ìš°ê¸° ì‹œë®¬ë ˆì´ì…˜ í•¨ìˆ˜ ===
        function simulateTypingGlitch(lineElement, cursorElement, maxGlitch, callback) {
            const glitchChars = "~!@#$%^&0123456789";
            let glitchCount = 0;
            const glitchInterval = 50; 

            function glitchStep() {
                if (glitchCount < maxGlitch) {
                    if (glitchCount % 2 === 0) {
                        const randomChar = glitchChars.charAt(Math.floor(Math.random() * glitchChars.length));
                        lineElement.insertBefore(document.createTextNode(randomChar), cursorElement);
                    } else {
                        const lastChild = lineElement.childNodes[lineElement.childNodes.length - 2];
                        if (lastChild && lastChild !== cursorElement) { 
                            lineElement.removeChild(lastChild);
                        }
                    }
                    glitchCount++;
                    setTimeout(glitchStep, glitchInterval);
                } else {
                    cursorElement.classList.remove('glitch-cursor');
                    cursorElement.classList.add('blinking-cursor');
                    callback(); 
                }
            }
            glitchStep();
        }

        // === ğŸ° ìµœì¢… ì‹œí€€ìŠ¤ ì²˜ë¦¬ (í† ë¼ ë“±ì¥ ë° y/n) ===
        function handleFinalSequence(lineElement, cursorSpan) {
            
            // 1. í† ë¼ ì´ë¯¸ì§€ ë“±ì¥ ë° í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ (ìƒˆ íƒ­ì—ì„œ YouTube ë§í¬ ì—´ê¸°)
            rabbitImg.style.display = 'block';
            rabbitImg.style.opacity = 1;
            rabbitImg.style.cursor = 'pointer'; // í´ë¦­ ê°€ëŠ¥ ì‹œê°í™”
            rabbitImg.onclick = () => {
                window.open(YOUTUBE_URL, '_blank');
            };
            
            // 2. y/n ì„ íƒì§€ ì œì‹œ (ì»¤ì„œ ë’¤ì— ë¶™ì„)
            const y_n_html = ' <span id="choice-y" style="cursor: pointer; margin-right: 20px;">y</span> / <span id="choice-n" style="cursor: pointer;">n</span>';
            
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = y_n_html;
            
            while (tempDiv.firstChild) {
                lineElement.insertBefore(tempDiv.firstChild, cursorSpan);
            }
            
            // 3. y í´ë¦­ ì‹œ YouTube ì´ë™ (í† ë¼ ì†Œë©¸ ì œê±°)
            document.getElementById('choice-y').addEventListener('click', (e) => {
                const choiceLine = e.target.closest('.line');
                
                // yë§Œ ë‚¨ê¸°ê³  y/nê³¼ ì»¤ì„œ ì œê±°
                const y_n_text = choiceLine.textContent;
                const cleanedText = y_n_text.substring(0, y_n_text.lastIndexOf('y / n')) + 'y';
                choiceLine.innerHTML = cleanedText;
                
                // ğŸ”¥ í† ë¼ ì†Œë©¸ ë¡œì§ ì œê±° ì™„ë£Œ
                
                // ğŸ”— YouTube ë§í¬ë¡œ ì´ë™
                window.open(YOUTUBE_URL, '_blank');
            });
            
            // 4. n í´ë¦­ ì‹œ ì²˜ë¦¬ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
            document.getElementById('choice-n').addEventListener('click', (e) => {
                const choiceLine = e.target.closest('.line');
                const y_n_text = choiceLine.textContent;
                const cleanedText = y_n_text.substring(0, y_n_text.lastIndexOf('y / n')) + 'n';
                choiceLine.innerHTML = cleanedText;
            });
        }


        // === ğŸ¬ ìŠ¤í¬ë¦½íŠ¸ ìˆœì°¨ ì‹¤í–‰ ì‹œì‘ ===
        function runScript() {
            if (scriptIndex < script.length) {
                const item = script[scriptIndex];
                scriptIndex++;
                typeLine(item, runScript);
            }
        }

        
        document.addEventListener('DOMContentLoaded', runScript);
    </script>
</body>
</html>